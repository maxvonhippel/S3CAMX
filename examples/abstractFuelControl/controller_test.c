#include "controller.c"
#include<stdio.h>


int throttle_angle_data[101] = {
88000, 97516, 106126, 113918, 120967, 127346, 133118, 138341, 143067, 147342,
151211, 154712, 157880, 160746, 163340, 165686, 167810, 169731, 171469, 173042,
174465, 175754, 176919, 177973, 178927, 179791, 180572, 181278, 181918, 182497,
183020, 183494, 183923, 184311, 184662, 184979, 185266, 185527, 185762, 185975,
186168, 186342, 186500, 186642, 186771, 186888, 186994, 187090, 187176, 187255,
187325, 187390, 187448, 187500, 187548, 187591, 187630, 187665, 187697, 187725,
187751, 187775, 187796, 187816, 187833, 187849, 187863, 187876, 187888, 187899,
187908, 187917, 187925, 187932, 187938, 187944, 187949, 187954, 187959, 187962,
187966, 187969, 187972, 187975, 187977, 187979, 187981, 187983, 187984, 187986,
187987, 187988, 187989, 187990, 187991, 187992, 187993, 187993, 187994, 187994,
187995};



int throttle_flow_data[101] = {
26342, 38499, 48135, 55677, 61195, 64792, 66683, 67196, 66740, 65738, 64549,
63422, 62480, 61751, 61209, 60811, 60515, 60291, 60118, 59980, 59869, 59777,
59701, 59638, 59583, 59537, 59497, 59463, 59433, 59407, 59385, 59365, 59347,
59332, 59318, 59306, 59295, 59285, 59277, 59269, 59262, 59256, 59251, 59246,
59241, 59237, 59234, 59231, 59228, 59225, 59223, 59221, 59219, 59217, 59215,
59214, 59213, 59212, 59211, 59210, 59209, 59208, 59207, 59207, 59206, 59206,
59205, 59205, 59205, 59204, 59204, 59204, 59203, 59203, 59203, 59203, 59203,
59202, 59202, 59202, 59202, 59202, 59202, 59202, 59202, 59202, 59202, 59202,
59201, 59201, 59201, 59201, 59201, 59201, 59201, 59201, 59201, 59201, 59201,
59201, 59201};

int airbyfuel_meas_data[101] = {
0, 6406, 12480, 18339, 23919, 29243, 34328, 39187, 43831, 48269, 52509, 56559,
60426, 64117, 67639, 70999, 74204, 77261, 80176, 82956, 85682, 88283, 90764,
93130, 95313, 97394, 99378, 101340, 103212, 104997, 106699, 108251, 109730,
111138, 112480, 113828, 115113, 116338, 117507, 118620, 119682, 120694, 121658,
122718, 123731, 124700, 125626, 126510, 127355, 128091, 128793, 129463, 130102,
130711, 131292, 131846, 132374, 132877, 133426, 133952, 134454, 134934, 135393,
135831, 136250, 136651, 137033, 137399, 137748, 138082, 138401, 138706, 138997,
139275, 139541, 139794, 140037, 140269, 140490, 140701, 140903, 141096, 141280,
141526, 141762, 141990, 142208, 142417, 142619, 142812, 142998, 143177, 143348,
143513, 143671, 143823, 143969, 144109, 144244, 144373, 144497};


int main(){

  int i, j;
  int input_arr[NUM_INPUTS];
  int i_state_arr[NUM_STATES];
  int x_arr[NUM_X];

  int o_state_arr[NUM_STATES];
  int output_arr[NUM_OUTPUTS];

  INPUT_VAL iv;
  RETURN_VAL rv;

  /* initialize stack memory */
  iv.input_arr = input_arr;
  iv.state_arr = i_state_arr;
  iv.x_arr = x_arr;

  rv.state_arr = o_state_arr;
  rv.output_arr= output_arr;
  
  /* initialize values */

  iv.state_arr[0] = 0;
  iv.state_arr[1] = 0;
  iv.state_arr[2] = 98200;
  iv.state_arr[3] = 1726;
  iv.state_arr[4] = 147000;
  iv.state_arr[5] = 0;
  iv.state_arr[6] = 0;
  iv.state_arr[7] = 0;
  iv.state_arr[8] = 0;
  iv.state_arr[9] = 0;
  iv.state_arr[10] = 0;
  iv.state_arr[11] = 0;
  iv.state_arr[12] = 1;
  iv.state_arr[13] = 0;

  for(i=0;i<=100;i++)
  {
    iv.x_arr[7] = 1047197;  /*engine speed*/
    iv.x_arr[8] = throttle_angle_data[i];        /*throttle_angle*/
    iv.x_arr[9] = throttle_flow_data[i];        /*throttle_flow*/
    iv.x_arr[10] = airbyfuel_meas_data[i];       /*airbyfuel_meas*/


    controller(&iv, &rv);

    for(j=0;j<NUM_STATES;j++)
      iv.state_arr[j] = rv.state_arr[j];
/*
    printf("CMD_FUEL = %d\t", rv.output_arr[0]);
    printf("mode = %d\t", rv.output_arr[1]);
    printf("AF_REF = %d\n", rv.output_arr[2]);
*/
  }
  return 0;
}
